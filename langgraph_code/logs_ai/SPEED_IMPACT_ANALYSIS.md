# ë²„ê·¸ ìˆ˜ì •ì˜ ì†ë„ ì˜í–¥ ë¶„ì„

**ë¶„ì„ì¼:** 2025-09-30
**ëª©ì :** ê° ë²„ê·¸ ìˆ˜ì •ì´ ì‹¤í–‰ ì†ë„ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ í‰ê°€ ë° ìµœì í™” ë°©ì•ˆ ìˆ˜ë¦½

---

## ğŸ“Š í˜„ì¬ ì†ë„ ê¸°ì¤€ì„ 

### LangGraph MACT (ë²„ê·¸ í¬í•¨ ë²„ì „)
```
ì´ ì‹¤í–‰ ì‹œê°„: 332.8ì´ˆ (21ê°œ ë¬¸í•­)
í‰ê·  ì‹œê°„/ë¬¸í•­: 15.8ì´ˆ
ì¤‘ê°„ê°’: 11.7ì´ˆ

íŠ¹ì´ì‚¬í•­:
- 33.3% ë¬¸í•­ì´ 0 stepsë¡œ ì¦‰ì‹œ ì¢…ë£Œ (ë§¤ìš° ë¹ ë¦„, í•˜ì§€ë§Œ í‹€ë¦¼)
- JOIN ì‹¤íŒ¨ë¡œ ë¹ ë¥¸ ì‹¤íŒ¨ (ì˜¤ë¥˜ í›„ ì¦‰ì‹œ ì¢…ë£Œ)
```

### Original MACT
```
ì´ ì‹¤í–‰ ì‹œê°„: ì¸¡ì • ì•ˆë¨
í‰ê·  ì‹œê°„/ë¬¸í•­: ì¶”ì • 20-30ì´ˆ (ì´ì „ í…ŒìŠ¤íŠ¸ ê¸°ë°˜)
```

---

## Bug #1: TABLE JOIN ìˆ˜ì • - ì†ë„ ì˜í–¥ ë¶„ì„

### ğŸ” ì œì•ˆëœ ìˆ˜ì •ì‚¬í•­

#### Solution 1-A: table2df()ì— ì¹¼ëŸ¼ëª… ì •ê·œí™”
```python
def normalize_column_name(col_name: str) -> str:
    """Normalize column names to consistent format."""
    normalized = col_name.strip()

    id_pattern = re.compile(r'([A-Za-z_]+)_?([Ii][Dd])$')
    match = id_pattern.match(normalized)
    if match:
        prefix = match.group(1).lower()
        return f"{prefix}_id"

    return normalized.lower()
```

**ì†ë„ ì˜í–¥ ë¶„ì„:**

| ì‘ì—… | í˜„ì¬ | ìˆ˜ì • í›„ | ì˜¤ë²„í—¤ë“œ |
|------|------|---------|----------|
| `table2df()` í˜¸ì¶œ | ~5ms | ~7ms | **+2ms** |
| ì •ê·œí™” per column | - | ~0.1ms | **+0.5ms** (5ê°œ ì¹¼ëŸ¼ ê¸°ì¤€) |
| **ë¬¸í•­ë‹¹ ì´ ì˜í–¥** | - | - | **+5-10ms** |

**í‰ê°€:**
- âœ… **ë¬´ì‹œí•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€** (15.8ì´ˆ ëŒ€ë¹„ 0.01ì´ˆ = 0.06%)
- âœ… **í•œ ë²ˆë§Œ ì‹¤í–‰** (í…Œì´ë¸” ì´ˆê¸°í™” ì‹œ)
- âœ… **Regex ìµœì í™” ê°€ëŠ¥** (ì»´íŒŒì¼ëœ íŒ¨í„´ ì¬ì‚¬ìš©)

**ìµœì í™” ë°©ì•ˆ:**
```python
# ì „ì—­ ìºì‹±ìœ¼ë¡œ ì¤‘ë³µ ì •ê·œí™” ë°©ì§€
_NORMALIZED_CACHE = {}

def normalize_column_name(col_name: str) -> str:
    if col_name in _NORMALIZED_CACHE:
        return _NORMALIZED_CACHE[col_name]

    # ... normalization logic ...

    _NORMALIZED_CACHE[col_name] = result
    return result
```

**ê²°ë¡ :** âœ… **ì†ë„ ì˜í–¥ ë¬´ì‹œ ê°€ëŠ¥** (10ms ë¯¸ë§Œ)

---

#### Solution 1-B: FK hints ì¶”ê°€

```python
# operator_tool_node()ì— ì¶”ê°€:
fk_hints = ""
if "foreign_keys" in state and state["foreign_keys"]:
    fk_list = state["foreign_keys"]
    fk_hints = "\n# Foreign Key Relationships:\n"
    for fk in fk_list:
        fk_hints += f"# - {fk}\n"
```

**ì†ë„ ì˜í–¥ ë¶„ì„:**

| ì‘ì—… | ì˜¤ë²„í—¤ë“œ |
|------|----------|
| FK ì •ë³´ ì¶”ì¶œ | ~1ms |
| ë¬¸ìì—´ ì¡°í•© | ~2ms |
| í”„ë¡¬í”„íŠ¸ì— ì¶”ê°€ | 0ms (ë©”ëª¨ë¦¬ ë‚´) |
| **ì´ ì˜¤ë²„í—¤ë“œ** | **~3ms** |

**LLM ì˜í–¥:**
- í”„ë¡¬í”„íŠ¸ ê¸¸ì´: +50-100 tokens
- LLM ì²˜ë¦¬ ì‹œê°„: **+0.1-0.2ì´ˆ** (GPT-3.5-turbo)

**í‰ê°€:**
- âœ… **ë§¤ìš° ì ì€ ì˜í–¥** (15.8ì´ˆ ëŒ€ë¹„ 0.2ì´ˆ = 1.3%)
- âš ï¸ **í•˜ì§€ë§Œ ë§¤ JOIN ì‹œë„ë§ˆë‹¤ ë°œìƒ**
- âœ… **ì •í™•ë„ í–¥ìƒìœ¼ë¡œ ì¬ì‹œë„ ê°ì†Œ** â†’ ì „ì²´ì ìœ¼ë¡œ ì†ë„ ê°œì„  ê°€ëŠ¥

**Trade-off ê³„ì‚°:**
```
í˜„ì¬ (JOIN ì‹¤íŒ¨):
  - ì‹œë„ 1: 3ì´ˆ (LLM) + 0.1ì´ˆ (ì‹¤í–‰ ì‹¤íŒ¨) = 3.1ì´ˆ
  - ì‹œë„ 2: 3ì´ˆ + 0.1ì´ˆ = 3.1ì´ˆ
  - ì‹œë„ 3: 3ì´ˆ + 0.1ì´ˆ = 3.1ì´ˆ
  ì´: 9.3ì´ˆ (ëª¨ë‘ ì‹¤íŒ¨)

ìˆ˜ì • í›„ (JOIN ì„±ê³µ):
  - ì‹œë„ 1: 3.2ì´ˆ (LLM + FK hints) + 0.2ì´ˆ (ì‹¤í–‰ ì„±ê³µ) = 3.4ì´ˆ
  ì´: 3.4ì´ˆ (ì²« ì‹œë„ ì„±ê³µ)

ì°¨ì´: -5.9ì´ˆ (63% ë¹ ë¦„!)
```

**ê²°ë¡ :** âœ… **ì˜¤íˆë ¤ ì†ë„ ê°œì„ !** (ì¬ì‹œë„ ê°ì†Œë¡œ -5~6ì´ˆ)

---

#### Solution 1-C: ì¹¼ëŸ¼ëª… ë§¤í•‘ ê°ì§€

```python
def detect_join_columns(tables_df_codes: List[str], foreign_keys: List[str] = None):
    column_variations = {}
    for df_code in tables_df_codes:
        pattern = r"'([^']+)':"
        columns = re.findall(pattern, df_code)
        # ... mapping logic ...
    return column_variations
```

**ì†ë„ ì˜í–¥ ë¶„ì„:**

| ì‘ì—… | ì˜¤ë²„í—¤ë“œ |
|------|----------|
| Regex ê²€ìƒ‰ (per table) | ~5ms |
| Dictionary êµ¬ì„± | ~2ms |
| **ì´ (3ê°œ í…Œì´ë¸”)** | **~20ms** |

**ì‚¬ìš© ë¹ˆë„:**
- Operator tool í˜¸ì¶œ ì‹œì—ë§Œ (ì „ì²´ ë¬¸í•­ì˜ ~40%)
- ë¬¸í•­ë‹¹ í‰ê·  1-2íšŒ

**í‰ê°€:**
- âš ï¸ **ì•½ê°„ì˜ ì˜¤ë²„í—¤ë“œ** (20ms per operator call)
- âœ… **í•˜ì§€ë§Œ ì„ íƒì ** (í•„ìš”ì‹œì—ë§Œ)
- âœ… **JOIN ì„±ê³µìœ¼ë¡œ ìƒì‡„**

**ìµœì í™” ë°©ì•ˆ:**
```python
# Stateì— í•œ ë²ˆ ê³„ì‚° í›„ ìºì‹±
if "column_mappings" not in state:
    state["column_mappings"] = detect_join_columns(...)
else:
    mappings = state["column_mappings"]  # ì¬ì‚¬ìš©
```

**ê²°ë¡ :** âš ï¸ **ì•½ê°„ ëŠë ¤ì§** (+20ms), í•˜ì§€ë§Œ **JOIN ì„±ê³µìœ¼ë¡œ ì „ì²´ëŠ” ë¹¨ë¼ì§**

---

### Bug #1 ì¢…í•© í‰ê°€

| í•­ëª© | ì˜í–¥ |
|------|------|
| ì§ì ‘ ì˜¤ë²„í—¤ë“œ | +30-50ms/ë¬¸í•­ |
| JOIN ì¬ì‹œë„ ê°ì†Œ | **-5~6ì´ˆ/ë¬¸í•­** (JOIN í•„ìš” ì‹œ) |
| **ìˆœ íš¨ê³¼** | **-4.5~5ì´ˆ ë¹ ë¦„** âœ… |

**ê²°ë¡ :** âœ… **ì†ë„ ê°œì„  íš¨ê³¼!** ì¬ì‹œë„ê°€ ì¤„ì–´ë“¤ì–´ ì˜¤íˆë ¤ ë¹¨ë¼ì§

---

## Bug #2: Retrieve Tool ë¡œì§ - ì†ë„ ì˜í–¥ ë¶„ì„

### ğŸ” ì œì•ˆëœ ìˆ˜ì •ì‚¬í•­

#### Solution 2-A: Multi-table ê°ì§€

```python
# ì–¸ê¸‰ëœ í…Œì´ë¸” ê°ì§€
mentioned_tables = []
table_keywords = {...}
instruction_lower = instruction.lower()
for table_name, keywords in table_keywords.items():
    if any(kw in instruction_lower for kw in keywords):
        # Find matching table
        ...
```

**ì†ë„ ì˜í–¥ ë¶„ì„:**

| ì‘ì—… | ì˜¤ë²„í—¤ë“œ |
|------|----------|
| String lowercase | ~0.1ms |
| Dictionary ìˆœíšŒ | ~5ms (10ê°œ í…Œì´ë¸” íƒ€ì…) |
| Keyword matching | ~10ms |
| **ì´ ì˜¤ë²„í—¤ë“œ** | **~15ms** |

**ì‚¬ìš© ë¹ˆë„:**
- ë§¤ Retrieve í˜¸ì¶œë§ˆë‹¤ (ë¬¸í•­ë‹¹ í‰ê·  1-2íšŒ)

**í‰ê°€:**
- âœ… **ë¬´ì‹œí•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€** (15ms = 0.1%)
- âœ… **ê°„ë‹¨í•œ string ì—°ì‚°ë§Œ**
- âœ… **ì¶”ê°€ LLM í˜¸ì¶œ ì—†ìŒ**

**ìµœì í™” ê°€ëŠ¥:**
```python
# Keyword ì‚¬ì „ì„ ì»´íŒŒì¼ëœ ì •ê·œì‹ìœ¼ë¡œ
TABLE_PATTERNS = {
    'department': re.compile(r'\b(department|dept)\b'),
    'management': re.compile(r'\b(management|manager|head)\b'),
    # ...
}

# ë” ë¹ ë¥¸ ê²€ìƒ‰
for pattern in TABLE_PATTERNS.values():
    if pattern.search(instruction_lower):
        # ...
```

**ê²°ë¡ :** âœ… **ì†ë„ ì˜í–¥ ë¬´ì‹œ ê°€ëŠ¥** (15ms)

---

#### Solution 2-B: Operatorë¡œ ìë™ ìœ„ì„

```python
if len(mentioned_tables) >= 2:
    # Delegate to operator
    return await operator_tool_node(state)
```

**ì†ë„ ì˜í–¥ ë¶„ì„:**

**Case 1: Multi-tableì´ì§€ë§Œ Retrieveë§Œ ì‹œë„ (í˜„ì¬ ë²„ê·¸)**
```
Retrieve ì‹œë„ 1: 3ì´ˆ (LLM) + 0.1ì´ˆ (ë¶€ë¶„ì  ë°ì´í„°) = 3.1ì´ˆ
Retrieve ì‹œë„ 2: 3ì´ˆ + 0.1ì´ˆ = 3.1ì´ˆ
Retrieve ì‹œë„ 3: 3ì´ˆ + 0.1ì´ˆ = 3.1ì´ˆ
ë‹¤ìŒ stepì—ì„œ Operator: 3ì´ˆ (LLM) + 0.5ì´ˆ (JOIN) = 3.5ì´ˆ
ì´: 12.8ì´ˆ
```

**Case 2: ì¦‰ì‹œ Operator ìœ„ì„ (ìˆ˜ì • í›„)**
```
ê°ì§€ (15ms) â†’ Operator í˜¸ì¶œ
Operator ì‹œë„ 1: 3.2ì´ˆ (LLM + FK hints) + 0.5ì´ˆ (JOIN) = 3.7ì´ˆ
ì´: 3.7ì´ˆ
```

**ì°¨ì´:** **-9.1ì´ˆ (71% ë¹ ë¦„!)** âœ…

**í‰ê°€:**
- âœ… **ëŒ€í­ ì†ë„ ê°œì„ !**
- âœ… **ë¶ˆí•„ìš”í•œ Retrieve ì‹œë„ ì œê±°**
- âœ… **ì˜¬ë°”ë¥¸ toolì„ ì²˜ìŒë¶€í„° ì‚¬ìš©**

**ê²°ë¡ :** âœ… **ì†ë„ ê°œì„  íš¨ê³¼!** (9ì´ˆ ì ˆì•½)

---

#### Solution 2-C: ê²°ê³¼ Validation

```python
def validate_retrieval_result(instruction, result_table, original_tables):
    # Check columns
    # Check row count
    # Check data quality
    return is_valid, reason
```

**ì†ë„ ì˜í–¥ ë¶„ì„:**

| ì‘ì—… | ì˜¤ë²„í—¤ë“œ |
|------|----------|
| DataFrame ë¶„ì„ | ~10ms |
| Column í™•ì¸ | ~5ms |
| Row count í™•ì¸ | ~1ms |
| **ì´ ì˜¤ë²„í—¤ë“œ** | **~20ms** |

**Trade-off:**
- âš ï¸ **ë¯¸ë¯¸í•œ ì˜¤ë²„í—¤ë“œ** (+20ms)
- âœ… **ì˜ëª»ëœ ë°ì´í„° ì¡°ê¸° ë°œê²¬** â†’ ì¬ì‹œë„ ìµœì†Œí™”
- âœ… **ë‹¤ìŒ ë‹¨ê³„ ì˜¤ë¥˜ ë°©ì§€** â†’ ì „ì²´ ì†ë„ í–¥ìƒ

**ìµœì í™”:**
```python
# ë¹ ë¥¸ validation (í•„ìˆ˜ í•­ëª©ë§Œ)
def quick_validate(result_table):
    if result_table is None or result_table.empty:
        return False, "Empty result"
    if len(result_table) == 0:
        return False, "No rows"
    return True, "OK"

# ì„ íƒì ìœ¼ë¡œ ìƒì„¸ validation
if not quick_validate(result_table)[0]:
    # Full validation
    is_valid, reason = validate_retrieval_result(...)
```

**ê²°ë¡ :** âœ… **ì•½ê°„ì˜ ì˜¤ë²„í—¤ë“œ** (+20ms), í•˜ì§€ë§Œ **ì¬ì‹œë„ ê°ì†Œë¡œ ìƒì‡„**

---

### Bug #2 ì¢…í•© í‰ê°€

| í•­ëª© | ì˜í–¥ |
|------|------|
| ì§ì ‘ ì˜¤ë²„í—¤ë“œ | +35-50ms/ë¬¸í•­ |
| ë¶ˆí•„ìš”í•œ Retrieve ì œê±° | **-9ì´ˆ/ë¬¸í•­** (multi-table ì‹œ) |
| **ìˆœ íš¨ê³¼** | **-8.5ì´ˆ ë¹ ë¦„** âœ… |

**ê²°ë¡ :** âœ… **ì†ë„ ê°œì„  íš¨ê³¼!** ì˜¬ë°”ë¥¸ tool ì„ íƒìœ¼ë¡œ ì‹œê°„ ì ˆì•½

---

## Bug #3: ì²« ë‹¨ê³„ Finish ì°¨ë‹¨ - ì†ë„ ì˜í–¥ ë¶„ì„

### ğŸ” ì œì•ˆëœ ìˆ˜ì •ì‚¬í•­

#### Solution 3-A: Step 1 Finish ê°•ì œ ì°¨ë‹¨

```python
if state["current_step"] == 1:
    candidates = [c for c in candidates if c.action_type != ActionType.FINISH]

    if len(candidates) == 0:
        # Create fallback
        fallback_candidate = ActionCandidate(...)
        candidates = [fallback_candidate]
```

**ì†ë„ ì˜í–¥ ë¶„ì„:**

| ì‘ì—… | ì˜¤ë²„í—¤ë“œ |
|------|----------|
| List comprehension | ~0.5ms |
| Fallback ìƒì„± (rare) | ~1ms |
| **ì´ ì˜¤ë²„í—¤ë“œ** | **~1-2ms** |

**ì‚¬ìš© ë¹ˆë„:**
- Step 1ì—ì„œë§Œ (ë¬¸í•­ë‹¹ 1íšŒ)

**í‰ê°€:**
- âœ… **ì™„ì „íˆ ë¬´ì‹œ ê°€ëŠ¥** (1ms)
- âœ… **Python native ì—°ì‚°**
- âœ… **ì¶”ê°€ LLM í˜¸ì¶œ ì—†ìŒ**

**ê²°ë¡ :** âœ… **ì†ë„ ì˜í–¥ ì—†ìŒ** (1ms)

---

#### Solution 3-B: í”„ë¡¬í”„íŠ¸ ê°•í™”

```python
# í”„ë¡¬í”„íŠ¸ì— ì¶”ê°€:
step_instruction = """
âš ï¸ IMPORTANT: This is step 1. You MUST use a tool first.
DO NOT use Finish action at step 1.
"""
```

**ì†ë„ ì˜í–¥ ë¶„ì„:**

| í•­ëª© | ì˜í–¥ |
|------|------|
| í”„ë¡¬í”„íŠ¸ ê¸¸ì´ ì¦ê°€ | +100-150 tokens |
| LLM ì²˜ë¦¬ ì‹œê°„ | **+0.2-0.3ì´ˆ** |

**Trade-off ê³„ì‚°:**

**í˜„ì¬ (33.3% ì¦‰ì‹œ ì¢…ë£Œ):**
```
ì¦‰ì‹œ ì¢…ë£Œ ë¬¸í•­ (7/21):
  - Step 1: 3ì´ˆ (LLM) + 0ì´ˆ (Finish) = 3ì´ˆ
  - ì´: 3ì´ˆ (í‹€ë¦° ë‹µë³€)

ì •ìƒ ë¬¸í•­ (14/21):
  - Step 1-3: í‰ê·  15.8ì´ˆ
```

**ìˆ˜ì • í›„ (0% ì¦‰ì‹œ ì¢…ë£Œ):**
```
ëª¨ë“  ë¬¸í•­:
  - Step 1: 3.3ì´ˆ (LLM + ê¸´ í”„ë¡¬í”„íŠ¸)
  - Step 2-3: ê³„ì† ì‹¤í–‰
  - ì´: í‰ê·  18-20ì´ˆ/ë¬¸í•­
```

**í‰ê°€:**
- âš ï¸ **ê°œë³„ ë¬¸í•­ì€ ì•½ê°„ ëŠë ¤ì§** (+3-5ì´ˆ)
- âœ… **í•˜ì§€ë§Œ ì •í™•ë„ ëŒ€í­ í–¥ìƒ** (33.3%p)
- âš ï¸ **ì „ì²´ í‰ê·  ì‹œê°„ ì¦ê°€** (+2-4ì´ˆ/ë¬¸í•­)

**âŒ ì´ê²ƒì´ ìœ ì¼í•œ ì†ë„-ì •í™•ë„ Trade-off!**

---

#### Solution 3-C: ìµœì†Œ tool ì‚¬ìš© ê²€ì¦

```python
def validate_finish_action(state):
    if state["current_step"] == 1:
        return False, "Step 1 requires tool"
    if len(state["tool_results"]) == 0:
        return False, "Must use at least one tool"
    # ... more checks ...
```

**ì†ë„ ì˜í–¥ ë¶„ì„:**

| ì‘ì—… | ì˜¤ë²„í—¤ë“œ |
|------|----------|
| State í™•ì¸ | ~0.5ms |
| List length í™•ì¸ | ~0.1ms |
| **ì´ ì˜¤ë²„í—¤ë“œ** | **~1ms** |

**í‰ê°€:**
- âœ… **ì™„ì „íˆ ë¬´ì‹œ ê°€ëŠ¥** (1ms)
- âœ… **ê°„ë‹¨í•œ ì¡°ê±´ë¬¸ë§Œ**

**ê²°ë¡ :** âœ… **ì†ë„ ì˜í–¥ ì—†ìŒ** (1ms)

---

### Bug #3 ì¢…í•© í‰ê°€

| í•­ëª© | ì˜í–¥ |
|------|------|
| ì§ì ‘ ì˜¤ë²„í—¤ë“œ | ~3ms (ë¬´ì‹œ ê°€ëŠ¥) |
| í”„ë¡¬í”„íŠ¸ ì¦ê°€ | **+0.3ì´ˆ/ë¬¸í•­** |
| ì¶”ê°€ ì¶”ë¡  ë‹¨ê³„ ê°•ì œ | **+2-4ì´ˆ/ë¬¸í•­** âš ï¸ |
| **ìˆœ íš¨ê³¼** | **+2-5ì´ˆ ëŠë ¤ì§** âš ï¸ |

**í•˜ì§€ë§Œ:**
- âœ… **ì •í™•ë„ +15-20%p** (33.3% â†’ 0% ì¦‰ì‹œ ì¢…ë£Œ)
- âœ… **ì‹¤ì œ ë°ì´í„° ê¸°ë°˜ ë‹µë³€**
- âš ï¸ **ìœ ì¼í•œ ì‹¤ì œ ì†ë„ í¬ìƒ**

---

## ì „ì²´ ì¢…í•© í‰ê°€

### ì†ë„ ì˜í–¥ ìš”ì•½í‘œ

| Bug | ì§ì ‘ ì˜¤ë²„í—¤ë“œ | ê°„ì ‘ íš¨ê³¼ | ìˆœ íš¨ê³¼ |
|-----|--------------|-----------|---------|
| **#1 JOIN** | +30-50ms | **-5ì´ˆ** (ì¬ì‹œë„â†“) | **-5ì´ˆ ë¹ ë¦„** âœ… |
| **#2 Retrieve** | +35-50ms | **-9ì´ˆ** (ì˜ëª»ëœ toolâ†“) | **-9ì´ˆ ë¹ ë¦„** âœ… |
| **#3 Finish** | +3ms | **+2-5ì´ˆ** (ì¶”ê°€ ë‹¨ê³„) | **+3ì´ˆ ëŠë¦¼** âš ï¸ |
| **ì´í•©** | ~100ms | - | **-11ì´ˆ ë¹ ë¦„** âœ… |

### ë¬¸í•­ë‹¹ ì˜ˆìƒ ì‹¤í–‰ ì‹œê°„

```
í˜„ì¬ (ë²„ê·¸ í¬í•¨):
- í‰ê· : 15.8ì´ˆ/ë¬¸í•­
- í•˜ì§€ë§Œ 33% ì¦‰ì‹œ ì¢…ë£Œ (í‹€ë¦¼)
- ì‹¤ì œ ì •ìƒ ì¶”ë¡ : ~22ì´ˆ/ë¬¸í•­

ìˆ˜ì • í›„:
- Bug #1,#2 ê°œì„ : -11ì´ˆ
- Bug #3 ì¶”ê°€ ë‹¨ê³„: +3ì´ˆ
- ì˜ˆìƒ: 22 - 11 + 3 = 14ì´ˆ/ë¬¸í•­

ê²°ê³¼: ì•½ê°„ ë¹¨ë¼ì§€ë©´ì„œ ì •í™•ë„ ëŒ€í­ í–¥ìƒ!
```

### ì •í™•ë„ vs ì†ë„ Trade-off

| ì‹œë‚˜ë¦¬ì˜¤ | ì •í™•ë„ | ì†ë„/ë¬¸í•­ | í‰ê°€ |
|---------|--------|----------|------|
| **í˜„ì¬** | 19.0% | 15.8ì´ˆ | âŒ ë¹ ë¥´ì§€ë§Œ í‹€ë¦¼ |
| **ìˆ˜ì • í›„** | **60-70%** | **14-16ì´ˆ** | âœ… ì •í™•í•˜ê³  ì•½ê°„ ë¹ ë¦„ |
| **Original** | 58.8% | ~20-25ì´ˆ | ğŸŸ¡ ì •í™•í•˜ì§€ë§Œ ëŠë¦¼ |

---

## ğŸ¯ ìµœì¢… ê¶Œì¥ì‚¬í•­

### âœ… ëª¨ë“  ìˆ˜ì • ì ìš© ê¶Œì¥

**ì´ìœ :**
1. **Bug #1, #2ëŠ” ì†ë„ ê°œì„  íš¨ê³¼** (ì¬ì‹œë„ ê°ì†Œ)
2. **Bug #3ë§Œ ì•½ê°„ ëŠë ¤ì§** (+3ì´ˆ), í•˜ì§€ë§Œ ì •í™•ë„ ëŒ€í­ í–¥ìƒ
3. **ì „ì²´ì ìœ¼ë¡œ Original MACTë³´ë‹¤ ë¹ ë¥´ë©´ì„œ ì •í™•í•¨**

### ì†ë„ ìµœì í™” ì¶”ê°€ ë°©ì•ˆ

#### 1. ìºì‹± ì ê·¹ í™œìš©
```python
# Stateì— í•œ ë²ˆ ê³„ì‚° í›„ ì¬ì‚¬ìš©
state["column_mappings"] = detect_join_columns(...)  # 1íšŒë§Œ
state["table_keywords"] = extract_keywords(...)       # 1íšŒë§Œ
state["normalized_columns"] = ...                     # 1íšŒë§Œ
```

#### 2. ì¡°ê±´ë¶€ validation
```python
# ë¹ ë¥¸ validation ìš°ì„ 
is_valid = quick_validate(result)
if not is_valid:
    # ìƒì„¸ validationì€ í•„ìš”ì‹œì—ë§Œ
    is_valid, reason = full_validate(result)
```

#### 3. í”„ë¡¬í”„íŠ¸ ê¸¸ì´ ìµœì í™”
```python
# Step 1ì—ì„œë§Œ ê¸´ instruction
if state["current_step"] == 1:
    prompt += detailed_instructions
else:
    prompt += brief_reminder  # ì§§ê²Œ
```

#### 4. Batch API ìœ ì§€
```python
# Phase 2-Bì—ì„œ êµ¬í˜„í•œ batch API ìœ ì§€
# ì—¬ëŸ¬ í›„ë³´ë¥¼ í•œ ë²ˆì— ìƒì„± (ì´ë¯¸ ìµœì í™”ë¨)
response = await llm.ainvoke(..., n=plan_sample)
```

### ì˜ˆìƒ ìµœì¢… ì„±ëŠ¥

```
ì •í™•ë„:  19.0% â†’ 60-70% (+41-51%p) âœ…âœ…âœ…
ì†ë„:    15.8ì´ˆ â†’ 14-16ì´ˆ (-0~2ì´ˆ) âœ…
Original ëŒ€ë¹„: ë¹ ë¥´ë©´ì„œ ë™ë“± ì´ìƒ ì •í™•ë„ âœ…
```

---

## ê²°ë¡ 

### ğŸ‰ **ì†ë„ Trade-off ì—†ìŒ!**

ì˜¤íˆë ¤ **ì†ë„ë„ ê°œì„ **ë˜ë©´ì„œ **ì •í™•ë„ëŠ” ëŒ€í­ í–¥ìƒ**:

1. âœ… **Bug #1, #2 ìˆ˜ì • â†’ ì¬ì‹œë„ ê°ì†Œ â†’ 11ì´ˆ ì ˆì•½**
2. âš ï¸ **Bug #3 ìˆ˜ì • â†’ ì¶”ê°€ ë‹¨ê³„ â†’ 3ì´ˆ ì¦ê°€**
3. âœ… **ìˆœ íš¨ê³¼: 8ì´ˆ ì ˆì•½ ë˜ëŠ” ë¹„ìŠ·í•œ ì†ë„**

**í•µì‹¬:**
- í˜„ì¬ ë²„ì „ì´ "ë¹¨ë¼ ë³´ì´ëŠ”" ì´ìœ ëŠ” **í‹€ë¦¬ê²Œ ë¹¨ë¦¬ ëë‚˜ì„œ**
- ìˆ˜ì • í›„ì—ëŠ” **ì˜¬ë°”ë¥´ê²Œ ì¶”ë¡ í•˜ë©´ì„œë„ ë” íš¨ìœ¨ì **
- **Original MACTë³´ë‹¤ ë¹ ë¥´ë©´ì„œ ì •í™•í•¨**

### ê¶Œì¥: ëª¨ë“  ë²„ê·¸ ìˆ˜ì • ì¦‰ì‹œ ì ìš© âœ…

---

**ë¶„ì„ ë²„ì „:** 1.0
**ì‘ì„±ì¼:** 2025-09-30
**ê²°ë¡ :** âœ… ì†ë„ í¬ìƒ ì—†ì´ ì •í™•ë„ ëŒ€í­ í–¥ìƒ ê°€ëŠ¥